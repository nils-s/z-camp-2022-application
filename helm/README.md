# Helm Chart to Deploy the Demo Application

Basic Helm chart generated by

```
helm create camp22
```

The chart has been minimally adjusted to make it work with the image generated
by the project's [GitHub repository action](../.github/workflows/build-image.yml)
and stored in the Azure container registry.

Most of the template files/resources (e.g. the service, horizontal autoscaler,
...) don't do anything (i.e. no resources are created from them) and could be
deleted.

## Installation

### Preconditions

Helm must be able to access the cluster in order to install the chart.
The Azure CLI tools can generate the appropriate Kubernetes config file via

```
az aks get-credentials --resource-group RESOURCE_GROUP --name CLUSTER_NAME
```

where `RESOURCE_GROUP` and `CLUSTER_NAME` are the names of the resource
group and cluster, respectively.

### Installation

The chart can be installed via

```
helm install NAME PATH
```

where `NAME` can be any name you like, and `PATH` is the path to the chart
folder (e.g. if you're running helm from within the helm folder, `PATH` would
be `./camp22`).
Instead of specifying a name, the `-g` (or `--generate-name`) flag can be used,
to let helm generate a name.

For more information see
[the helm docs](https://helm.sh/docs/helm/helm_install/).

## Trying it out

Once the application has been deployed into the cluster:

```
kubectl get pods --namespace default -l "app.kubernetes.io/name=camp22,app.kubernetes.io/instance=RELEASE_NAME" -o jsonpath="{.items[0].metadata.name}"

kubectl --namespace default port-forward POD_NAME 8080:8080
```

where `RELEASE_NAME` in the first command is the name specified during
`helm install`, and `POD_NAME` in the second command is the value returned
by the first command.

The application should then be reachable in a browser on `localhost:8080`.

The commands can also be copied and pasted directly from the shell: they are
printed by `helm install` once it's done, including the correct `RELEASE_NAME`
(especially helpful if `--generate-name` was used).